# ================================================================
# VIRICAL DEVELOPMENT .HTACCESS (PODMAN LOCALHOST:9000)
# ================================================================
# Development version of production .htaccess
# Removes HTTPS redirects and domain-specific rules
# Keeps performance, security, and WordPress permalink fixes

# ================================================================
# WORDPRESS PERMALINKS (CRITICAL FOR 404 FIX)
# ================================================================
<IfModule mod_rewrite.c>
RewriteEngine On

# WordPress permalink structure
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# ================================================================
# VIETNAMESE CHARACTER SUPPORT
# ================================================================
# Ensure Vietnamese characters in URLs work properly
<IfModule mod_rewrite.c>
# Handle Vietnamese characters in URLs
RewriteCond %{REQUEST_URI} ^/.*[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđĐÀÁẠẢÃÂẦẤẬẨẪĂẰẮẶẲẴÈÉẸẺẼÊỀẾỆỂỄÌÍỊỈĨÒÓỌỎÕÔỒỐỘỔỖƠỜỚỢỞỠÙÚỤỦŨƯỪỨỰỬỮỲÝỴỶỸ].*$
RewriteRule ^(.*)$ /index.php?pagename=$1 [QSA,L]
</IfModule>

# ================================================================
# PERFORMANCE & CACHING
# ================================================================
# Enable compression
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Browser caching
<IfModule mod_expires.c>
ExpiresActive on
ExpiresByType image/png "access plus 1 month"
ExpiresByType image/jpg "access plus 1 month"
ExpiresByType image/jpeg "access plus 1 month"
ExpiresByType image/gif "access plus 1 month"
ExpiresByType image/ico "access plus 1 month"
ExpiresByType text/css "access plus 1 month"
ExpiresByType application/pdf "access plus 1 month"
ExpiresByType text/javascript "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# ================================================================
# DEVELOPMENT SECURITY HEADERS (RELAXED)
# ================================================================
<IfModule mod_headers.c>
# Basic security headers (less strict for development)
Header always set X-Content-Type-Options nosniff
Header always set X-XSS-Protection "1; mode=block"

# Remove server signature
Header unset Server
Header unset X-Powered-By
</IfModule>

# ================================================================
# ERROR DOCUMENTS
# ================================================================
# Custom error pages
ErrorDocument 404 /index.php?error=404
ErrorDocument 403 /index.php?error=403
ErrorDocument 500 /index.php?error=500

# ================================================================
# BLOCK HARMFUL BOTS AND REQUESTS
# ================================================================
# Block common attack patterns
<IfModule mod_rewrite.c>
RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} proc/self/environ [OR]
RewriteCond %{QUERY_STRING} mosConfig_[a-zA-Z_]{1,21}(=|\%3D) [OR]
RewriteCond %{QUERY_STRING} base64_(en|de)code\(.*\) [OR]
RewriteCond %{QUERY_STRING} (\<|%3C).*iframe.*(\>|%3E) [NC]
RewriteRule ^(.*)$ - [F,L]
</IfModule>

# ================================================================
# FILE ACCESS RESTRICTIONS
# ================================================================
# Protect wp-config.php
<Files wp-config.php>
Order deny,allow
Deny from all
</Files>

# Protect .htaccess
<Files .htaccess>
Order deny,allow
Deny from all
</Files>

# Protect sensitive files
<FilesMatch "^(wp-config\.php|\.htaccess|\.htpasswd|error_log|php\.ini)$">
Order deny,allow
Deny from all
</FilesMatch>

# ================================================================
# PHP SETTINGS (if allowed by hosting)
# ================================================================
# Increase memory limit and execution time
<IfModule mod_php7.c>
php_value memory_limit 256M
php_value max_execution_time 300
php_value upload_max_filesize 64M
php_value post_max_size 64M
</IfModule>

<IfModule mod_php8.c>
php_value memory_limit 256M
php_value max_execution_time 300
php_value upload_max_filesize 64M
php_value post_max_size 64M
</IfModule>

# END WordPress